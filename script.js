document.addEventListener("DOMContentLoaded", (async () => { const t = document.getElementById("preloader"); t && (window.addEventListener("load", (() => t.classList.add("hidden"))), setTimeout((() => t.classList.add("hidden")), 1500)); const e = document.getElementById("scrollTopBtn"); e && (window.onscroll = () => { document.body.scrollTop > 200 || document.documentElement.scrollTop > 200 ? e.classList.add("visible") : e.classList.remove("visible") }, e.addEventListener("click", (t => { t.preventDefault(), window.scrollTo({ top: 0, behavior: "smooth" }) }))); const a = document.getElementById("theme-toggle"); if (a) { const t = document.body, e = e => { "dark" === e ? (t.classList.add("dark-theme"), a.checked = !0) : (t.classList.remove("dark-theme"), a.checked = !1) }, n = localStorage.getItem("theme"), o = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches; n ? e(n) : o && e("dark"), a.addEventListener("change", (() => { const t = a.checked ? "dark" : "light"; localStorage.setItem("theme", t), e(t) })) } async function n(t) { try { const e = await fetch(`${t}?t=${(new Date).getTime()}`); if (!e.ok) return []; const a = await e.json(), n = Object.keys(a)[0]; return Array.isArray(a[n]) ? a[n] : [] } catch (e) { return console.error(`Erro ao processar JSON de ${t}:`, e), [] } } async function o(t, e, a, o) { const s = document.getElementById(e); if (!s) return; const c = await n(t); if (!c || 0 === c.length) return void ("gallery-section" !== e && (s.innerHTML = '<p class="col-12 text-center lead text-muted mt-5">De momento, não há publicações nesta secção.</p>')); c.sort(((t, e) => new Date(e.data_publicacao || e.date || 0) - new Date(t.data_publicacao || t.date || 0))); const d = c.map((t => a(t, o, t.id))).join(""); s.innerHTML = d, "empregos.html" === o && c.forEach((t => { const e = { "@context": "https://schema.org/", "@type": "JobPosting", title: t.titulo, description: t.descricao, datePosted: t.data_publicacao, validThrough: t.data_vencimento || "", employmentType: "FULL_TIME", hiringOrganization: { "@type": "Organization", name: "Empresa (Confidencial)" }, jobLocation: { "@type": "Place", address: { "@type": "PostalAddress", addressLocality: t.localizacao, addressCountry: "PT" } } }, a = document.createElement("script"); a.type = "application/ld+json", a.textContent = JSON.stringify(e), document.head.appendChild(a) })), "blog.html" === o && function () { document.querySelectorAll(".read-more-btn").forEach((t => { t.addEventListener("click", (t => { const e = t.target.closest(".blog-post-card"), a = e.querySelector(".summary-content"), n = e.querySelector(".full-content"); a.style.display = "none", n.style.display = "block", t.target.style.display = "none" })) })); const t = document.querySelectorAll(".blog-nav .nav-link"), e = document.getElementById("posts-section"), a = document.getElementById("gallery-section"); t.forEach((n => { n.addEventListener("click", (n => { n.preventDefault(), t.forEach((t => t.classList.remove("active"))), n.target.classList.add("active"); const o = n.target.getAttribute("data-target"); if ("galeria" === o) e.style.display = "none", a.style.display = "flex"; else { a.style.display = "none", e.style.display = "flex"; document.querySelectorAll(".blog-post-item").forEach((t => { "all" === o || t.dataset.category === o ? t.style.display = "block" : t.style.display = "none" })) } })) })) }() } function s(t) { if (!t || !t.data_publicacao || !t.data_vencimento) return `<div class="date-info">ID: ${t.id || "N/A"}</div>`; const e = new Date(t.data_publicacao), a = new Date(t.data_vencimento), n = new Date; n.setHours(0, 0, 0, 0); const o = e.toLocaleDateString("pt-PT", { day: "2-digit", month: "2-digit", year: "numeric" }), s = a.toLocaleDateString("pt-PT", { day: "2-digit", month: "2-digit", year: "numeric" }), c = a < n; return `<div class="date-info">Publicado: ${o} <br> <span class="${c ? "vencido" : ""}">Vencimento: ${s} ${c ? "(Vencido)" : ""}</span></div>` } function c(t, e) { const a = `https://portugalapoia.com/${e}#${t.id}`, n = `Vi este anúncio em PortugalApoia e lembrei-me de ti: "${t.titulo}"`, o = encodeURIComponent(a); return `<div class="share-buttons"><small class="share-label">Partilhar:</small><a href="https://api.whatsapp.com/send?text=${encodeURIComponent(n)}%20${o}" target="_blank" rel="noopener noreferrer" title="Partilhar no WhatsApp" class="share-btn whatsapp"><i class="fab fa-whatsapp"></i></a><a href="https://www.facebook.com/sharer/sharer.php?u=${o}" target="_blank" rel="noopener noreferrer" title="Partilhar no Facebook" class="share-btn facebook"><i class="fab fa-facebook-f"></i></a></div>` } o("/_dados/doacoes.json", "announcements-grid", (function (t, e) { return `\n        <div class="col-md-4 mb-4">\n            <div class="card h-100">\n                ${t.imagem ? `<img src="${t.imagem}" class="card-img-top" alt="${t.titulo}">` : `<div class="image-placeholder">${t.titulo}</div>`}\n                <div class="card-body">\n                    <h5 class="card-title">${t.titulo}</h5>\n                    <h6 class="card-subtitle mb-2 text-muted">${t.localizacao}</h6>\n                    <p class="card-text">${t.descricao}</p>\n                </div>\n                <div class="card-footer">\n                    ${s(t)}\n                    ${c(t, e)}\n                </div>\n            </div>\n        </div>\n        ` }), "doações.html"), o("/_dados/empregos.json", "jobs-grid", (function (t, e, a) { return `\n        <div class="col-md-4 mb-4">\n            <div class="card h-100">\n                <div class="card-body">\n                    <h5 class="card-title">${t.titulo}</h5>\n                    <h6 class="card-subtitle mb-2 text-muted">${t.localizacao}</h6>\n                    <p class="card-text">${t.descricao}</p>\n                </div>\n                <div class="card-footer">\n                    ${s(t)}\n                    ${c(t, e)}\n                </div>\n            </div>\n        </div>\n        ` }), "empregos.html"), o("/_dados/servicos.json", "services-grid", (function (t, e) { const a = t.logo_empresa ? `<div class="service-card-logo"><img src="${t.logo_empresa}" alt="Logo"></div>` : ""; return `\n        <div class="col-md-4 mb-4">\n            <div class="card h-100">\n                ${t.valor_servico ? `<div class="card-price">${t.valor_servico}</div>` : ""}\n                <div class="card-body">\n                    ${a}\n                    <h5 class="card-title">${t.titulo}</h5>\n                    <h6 class="card-subtitle mb-2 text-muted">${t.localizacao}</h6>\n                    <p class="card-text">${t.descricao}</p>\n                </div>\n                <div class="card-footer">\n                    ${s(t)}\n                    ${c(t, e)}\n                </div>\n            </div>\n        </div>\n        ` }), "serviços.html"), o("/_dados/habitacao.json", "housing-grid", (function (t, e) { return `\n        <div class="col-md-4 mb-4">\n            <div class="card h-100">\n                ${t.imagens && t.imagens.length > 0 && t.imagens[0].imagem_url ? `<img src="${t.imagens[0].imagem_url}" class="card-img-top" alt="${t.titulo}">` : `<div class="image-placeholder">${t.titulo}</div>`}\n                ${t.valor_anuncio ? `<div class="card-price">${t.valor_anuncio}</div>` : ""}\n                <div class="card-body">\n                    <h5 class="card-title">${t.titulo}</h5>\n                    <h6 class="card-subtitle mb-2 text-muted">${t.localizacao}</h6>\n                    <p class="card-text">${t.descricao}</p>\n                </div>\n                <div class="card-footer">\n                    ${s(t)}\n                    ${c(t, e)}\n                </div>\n            </div>\n        </div>\n        ` }), "habitação.html"), o("/_dados/blog.json", "posts-section", (function (t) { const e = new Date(t.date).toLocaleDateString("pt-PT", { day: "numeric", month: "long", year: "numeric" }); return `\n            <div class="col-lg-4 col-md-6 mb-4 blog-post-item" data-category="${t.category}">\n                <div class="blog-post-card">\n                    <img class="card-img-top" src="${t.image}" alt="${t.title}">\n                    <div class="card-body">\n                        <h5 class="card-title">${t.title}</h5>\n                        <p class="text-muted small">Publicado em: ${e}</p>\n                        <p class="card-text summary-content">${t.summary}</p>\n                        <div class="full-content" style="display: none;">\n                            <p>${t.body.replace(/\n/g, "</p><p>")}</p>\n                        </div>\n                        <button class="btn btn-outline-primary read-more-btn mt-auto">Ler Mais</button>\n                    </div>\n                </div>\n            </div>\n        ` }), "blog.html"), o("/_dados/galeria.json", "gallery-section", (function (t) { const e = new Date(t.date).toLocaleDateString("pt-PT", { day: "numeric", month: "long", year: "numeric" }); return `\n            <div class="col-lg-6 col-md-12 mb-4">\n                <div class="gallery-item">\n                    <img src="${t.image}" alt="${t.title}">\n                    <div class="caption">\n                        <h5>${t.title}</h5>\n                        <p>${t.caption}</p>\n                        <small class="text-white-50">${e}</small>\n                    </div>\n                </div>\n            </div>\n        ` }), "blog.html"), async function () { const t = await n("/_dados/doacoes.json"), e = await n("/_dados/empregos.json"), a = await n("/_dados/servicos.json"), o = t.length, s = e.length, c = o + s + a.length; document.getElementById("contador-doacoes").textContent = `${o}+`, document.getElementById("contador-empregos").textContent = `${s}+`, document.getElementById("contador-total").textContent = `${c}+` }(), document.body.classList.contains("home") && async function () { const t = await n("/_dados/homepage.json"); t && (document.getElementById("hero-title").textContent = t.hero_title || "Bem-vindo ao Portugal Apoia", document.getElementById("hero-subtitle").textContent = t.hero_subtitle || "A sua plataforma de apoio comunitário para encontrar e oferecer ajuda.", document.getElementById("doacoes-text").textContent = t.impact_counters.doacoes_text || "Doações Realizadas", document.getElementById("empregos-text").textContent = t.impact_counters.emprego_text || "Empregos Publicados", document.getElementById("total-text").textContent = t.impact_counters.total_text || "Total de Anúncios") }(), function () { const t = document.getElementById("searchButton"), e = document.getElementById("clearButton"), a = document.getElementById("searchInput"), n = document.getElementById("locationInput"), o = document.getElementById("no-results"), s = document.querySelector('.row[id$="-grid"]').id, c = document.getElementById(s); function d() { const t = a.value.toLowerCase(), e = n.value.toLowerCase(), s = c.querySelectorAll(".col-md-4"); let d = !1; s.forEach((a => { const n = a.querySelector(".card-title").textContent.toLowerCase(), o = a.querySelector(".card-subtitle").textContent.toLowerCase(), s = a.querySelector(".card-text").textContent.toLowerCase(), c = n.includes(t) || s.includes(t), l = o.includes(e); c && l ? (a.style.display = "", d = !0) : a.style.display = "none" })), o.style.display = d ? "none" : "block" } t && t.addEventListener("click", d), e && e.addEventListener("click", (function () { a.value = "", n.value = "", d() })) }() }));