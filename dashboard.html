<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Anúncios - PortugalApoia</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 25px; }
        .container { max-width: 1400px; margin: auto; }
        h1, h2 { color: #0A3D62; }
        .dashboard { display: grid; grid-template-columns: 450px 1fr; gap: 40px; }
        .form-section, .list-section { background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #00834B; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background-color: #00663a; }
        #output-code { background: #e9ecef; border: 1px solid #ccc; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; min-height: 100px; max-height: 300px; overflow-y: auto; }
        #copy-button { background: #0A3D62; margin-top: 10px; }
        .anuncio-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .anuncio-item:last-child { border-bottom: none; }
        .anuncio-actions button { width: auto; font-size: 12px; padding: 5px 10px; margin-left: 5px; }
        .btn-edit { background-color: #e67e22; }
        .btn-delete { background-color: #c0392b; }
        #anuncios-list { max-height: 600px; overflow-y: auto; }
        #update-info { background-color: #fffbe6; border: 1px solid #ffe58f; padding: 15px; border-radius: 4px; margin-top: 20px; }
        .image-selector-container { border: 1px solid #ccc; padding: 10px; border-radius: 4px; }
        .image-selector { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; max-height: 200px; overflow-y: auto; margin-top: 10px;}
        .image-selector img { width: 100%; height: 60px; object-fit: contain; cursor: pointer; border: 2px solid transparent; border-radius: 4px; }
        .image-selector img.selected { border-color: #00834B; }
    </style>
    <script src="dados.js"></script>
</head>
<body>
<div class="container">
    <h1>Dashboard de Anúncios PortugalApoia</h1>
    <div class="dashboard">
        <div class="form-section">
            <h2 id="form-title">Criar Novo Anúncio</h2>
            <label for="id">ID (Ex: EMP-035)</label>
            <input type="text" id="id" placeholder="ID único">
            <label for="tipo">Tipo</label>
            <select id="tipo">
                <option value="emprego">Emprego</option>
                <option value="servico">Serviço</option>
                <option value="habitacao">Habitação</option>
                <option value="doacao">Doação</option>
            </select>
            <label for="titulo">Título</label>
            <input type="text" id="titulo" placeholder="Título do anúncio">
            <label for="cidade">Cidade</label>
            <input type="text" id="cidade" placeholder="Cidade">
            <label for="descricao">Descrição</label>
            <textarea id="descricao" rows="4" placeholder="Descrição detalhada"></textarea>
            <label for="contacto">Contacto Principal</label>
            <input type="text" id="contacto" placeholder="tel:+351... ou mailto:...">
            
            <label for="imagem-search">Procurar e Selecionar Imagem</label>
            <div class="image-selector-container">
                <input type="text" id="imagem-search" placeholder="Escreva para filtrar imagens...">
                <div id="image-selector" class="image-selector"></div>
            </div>
            <input type="hidden" id="imagem">

            <button id="save-button" style="margin-top: 15px;">Guardar e Gerar Código</button>
            <div id="update-info" style="display:none;">
                <h3>Atenção!</h3>
                <p>Copiou o código atualizado. Agora, **substitua todo o conteúdo** do seu arquivo `dados.js` com este novo código para guardar as suas alterações.</p>
            </div>
        </div>
        <div class="list-section">
            <h2>Anúncios Existentes</h2>
            <div id="anuncios-list"></div>
            <div style="margin-top:20px;">
                <h2>Código para Copiar</h2>
                <pre id="output-code"></pre>
                <button id="copy-button" style="display:none;">Copiar Todo o Código</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentAnuncios = todosOsAnuncios ? [...todosOsAnuncios] : [];
    let editingId = null;

    const imageFiles = [
        'aluguel_habitacao_quarto.png', 'arquiteto.png', 'arquiteto_preparador.png', 'conductor.png', 
        'conductor_camion.png', 'conductor_minicargador.png', 'conductor_retroexcavadora.png', 
        'conductor_volqueta.png', 'cozinha_ajudante.png', 'cozinha_chef.png', 'desing_grafic.png', 
        'desing_publicidad-digital.png', 'eletricista.png', 'engineer_mechanic.png', 'enfermeria.png', 
        'hotel_camarera.png', 'hotel_recepcionista.png', 'instalador_drywall_.png', 'lavanderia.png', 
        'Limpeza_casas.png', 'limpeza_geral.png', 'mecânico_automóveis.png', 'mesero_camarero.png', 
        'modista.png', 'ninera.png', 'obra_carpinteiro_cofragem.png', 'obra_carpinteiro_cozinha_puertas.png', 
        'obra_encarregado.png', 'obra_pedreiro.png', 'obra_pintor.png', 'obra_plomero.png', 
        'padeiro.png', 'pizzero.png', 'programmer.png'
    ];
    imageFiles.sort();
    
    const imageSelector = document.getElementById('image-selector');
    const imageSearchInput = document.getElementById('imagem-search');
    const hiddenImageInput = document.getElementById('imagem');

    function renderImages(filter = '') {
        imageSelector.innerHTML = '';
        const filteredImages = imageFiles.filter(file => file.includes(filter.toLowerCase()));
        
        filteredImages.forEach(file => {
            const fullPath = `img_servicos/${file}`;
            const img = document.createElement('img');
            img.src = fullPath;
            img.title = file;
            img.dataset.path = fullPath;
            imageSelector.appendChild(img);
            img.addEventListener('click', () => {
                document.querySelectorAll('#image-selector img').forEach(i => i.classList.remove('selected'));
                img.classList.add('selected');
                hiddenImageInput.value = img.dataset.path;
            });
        });
    }

    imageSearchInput.addEventListener('keyup', () => {
        renderImages(imageSearchInput.value);
    });

    // El resto del script del dashboard (no necesita cambios)
    const formTitle = document.getElementById('form-title');
    const idInput = document.getElementById('id');
    // ... (resto de las variables)

    function renderList() { /* ... */ }
    function generateFullCode() { /* ... */ }
    // ... (resto de las funciones y event listeners)

    // Cargar la lista e imágenes al iniciar
    renderList();
    renderImages();
</script>
</body>
</html>