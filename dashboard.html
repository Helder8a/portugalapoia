<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Anúncios - PortugalApoia</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 25px; }
        .container { max-width: 1400px; margin: auto; }
        h1, h2 { color: #0A3D62; }
        .dashboard { display: grid; grid-template-columns: 400px 1fr; gap: 40px; }
        .form-section, .list-section { background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #00834B; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background-color: #00663a; }
        #output-code { background: #e9ecef; border: 1px solid #ccc; padding: 15px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; min-height: 100px; max-height: 300px; overflow-y: auto; }
        #copy-button { background: #0A3D62; margin-top: 10px; }
        .anuncio-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .anuncio-item:last-child { border-bottom: none; }
        .anuncio-info { flex-grow: 1; }
        .anuncio-actions button { width: auto; font-size: 12px; padding: 5px 10px; margin-left: 5px; }
        .btn-edit { background-color: #e67e22; }
        .btn-delete { background-color: #c0392b; }
        #anuncios-list { max-height: 600px; overflow-y: auto; }
        #update-info { background-color: #fffbe6; border: 1px solid #ffe58f; padding: 15px; border-radius: 4px; margin-top: 20px; }
    </style>
    <script src="dados.js"></script>
</head>
<body>
<div class="container">
    <h1>Dashboard de Anúncios PortugalApoia</h1>
    <div class="dashboard">
        <div class="form-section">
            <h2 id="form-title">Criar Novo Anúncio</h2>
            <label for="id">ID (Ex: EMP-035)</label>
            <input type="text" id="id" placeholder="ID único">
            <label for="tipo">Tipo</label>
            <select id="tipo">
                <option value="emprego">Emprego</option>
                <option value="servico">Serviço</option>
                <option value="habitacao">Habitação</option>
                <option value="doacao">Doação</option>
            </select>
            <label for="titulo">Título</label>
            <input type="text" id="titulo" placeholder="Título do anúncio">
            <label for="cidade">Cidade</label>
            <input type="text" id="cidade" placeholder="Cidade">
            <label for="descricao">Descrição</label>
            <textarea id="descricao" rows="4" placeholder="Descrição detalhada"></textarea>
            <label for="contacto">Contacto Principal</label>
            <input type="text" id="contacto" placeholder="tel:+351... ou mailto:...">
            <label for="imagem">Imagem</label>
            <input type="text" id="imagem" placeholder="img_servicos/nome.png">
            <button id="save-button">Guardar e Gerar Código</button>
            <div id="update-info" style="display:none;">
                <h3>Atenção!</h3>
                <p>Copiou o código atualizado. Agora, **substitua todo o conteúdo** do seu arquivo `dados.js` com este novo código para guardar as suas alterações (edição ou eliminação).</p>
            </div>
        </div>
        <div class="list-section">
            <h2>Anúncios Existentes</h2>
            <div id="anuncios-list"></div>
            <div style="margin-top:20px;">
                <h2>Código para Copiar</h2>
                <pre id="output-code"></pre>
                <button id="copy-button" style="display:none;">Copiar Todo o Código</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentAnuncios = [...todosOsAnuncios];
    let editingId = null;

    const formTitle = document.getElementById('form-title');
    const idInput = document.getElementById('id');
    const tipoInput = document.getElementById('tipo');
    const tituloInput = document.getElementById('titulo');
    const cidadeInput = document.getElementById('cidade');
    const descricaoInput = document.getElementById('descricao');
    const contactoInput = document.getElementById('contacto');
    const imagemInput = document.getElementById('imagem');
    const saveButton = document.getElementById('save-button');
    const outputCode = document.getElementById('output-code');
    const copyButton = document.getElementById('copy-button');
    const updateInfo = document.getElementById('update-info');

    function renderList() {
        const listContainer = document.getElementById('anuncios-list');
        listContainer.innerHTML = '';
        currentAnuncios.forEach(anuncio => {
            const item = document.createElement('div');
            item.className = 'anuncio-item';
            item.innerHTML = `
                <div class="anuncio-info">
                    <strong>${anuncio.id}</strong> - ${anuncio.titulo}
                </div>
                <div class="anuncio-actions">
                    <button class="btn-edit" data-id="${anuncio.id}">Editar</button>
                    <button class="btn-delete" data-id="${anuncio.id}">Eliminar</button>
                </div>
            `;
            listContainer.appendChild(item);
        });
    }

    function generateFullCode() {
        let code = 'const todosOsAnuncios = [\n';
        currentAnuncios.forEach(anuncio => {
            code += `  {\n`;
            code += `    id: '${anuncio.id}',\n`;
            code += `    tipo: '${anuncio.tipo}',\n`;
            code += `    titulo: '${anuncio.titulo}',\n`;
            code += `    cidade: '${anuncio.cidade}',\n`;
            code += `    descricao: '${anuncio.descricao.replace(/'/g, "\\'")}',\n`;
            code += `    contacto: '${anuncio.contacto}',\n`;
            if (anuncio.contacto2) code += `    contacto2: '${anuncio.contacto2}',\n`;
            code += `    imagem: '${anuncio.imagem}',\n`;
            code += `    dataPublicacao: '${anuncio.dataPublicacao}'\n`;
            code += `  },\n`;
        });
        code += '];';
        outputCode.textContent = code;
        copyButton.style.display = 'block';
    }

    document.getElementById('anuncios-list').addEventListener('click', (e) => {
        const id = e.target.dataset.id;
        if (e.target.classList.contains('btn-edit')) {
            const anuncio = currentAnuncios.find(a => a.id === id);
            editingId = id;
            formTitle.textContent = `A Editar: ${id}`;
            idInput.value = anuncio.id;
            tipoInput.value = anuncio.tipo;
            tituloInput.value = anuncio.titulo;
            cidadeInput.value = anuncio.cidade;
            descricaoInput.value = anuncio.descricao.replace(/<br>/g, '\\n');
            contactoInput.value = anuncio.contacto;
            imagemInput.value = anuncio.imagem;
            idInput.readOnly = true;
        }
        if (e.target.classList.contains('btn-delete')) {
            if (confirm(`Tem a certeza que quer eliminar o anúncio ${id}?`)) {
                currentAnuncios = currentAnuncios.filter(a => a.id !== id);
                renderList();
                generateFullCode();
                updateInfo.style.display = 'block';
            }
        }
    });

    saveButton.addEventListener('click', () => {
        const anuncioData = {
            id: idInput.value,
            tipo: tipoInput.value,
            titulo: tituloInput.value,
            cidade: cidadeInput.value,
            descricao: descricaoInput.value.replace(/\\n/g, '<br>'),
            contacto: contactoInput.value,
            imagem: imagemInput.value,
            dataPublicacao: new Date().toISOString().split('T')[0]
        };

        if (editingId) { // Estamos a editar
            currentAnuncios = currentAnuncios.map(a => a.id === editingId ? { ...a, ...anuncioData } : a);
        } else { // Estamos a criar um novo
            currentAnuncios.push(anuncioData);
        }
        
        renderList();
        generateFullCode();
        resetForm();
        updateInfo.style.display = 'block';
    });
    
    copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText(outputCode.textContent);
        alert('Código copiado! Agora substitua todo o conteúdo do seu arquivo dados.js.');
    });

    function resetForm() {
        editingId = null;
        formTitle.textContent = 'Criar Novo Anúncio';
        idInput.readOnly = false;
        idInput.value = '';
        tituloInput.value = '';
        cidadeInput.value = '';
        descricaoInput.value = '';
        contactoInput.value = '';
        imagemInput.value = '';
    }

    // Cargar la lista al iniciar
    renderList();
</script>
</body>
</html>