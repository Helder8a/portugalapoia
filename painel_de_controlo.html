<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controlo Unificado - PortugalApoia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #0A3D62;
            --color-accent: #00834B;
            --color-donation: #ffd700;
            --color-urgent: #e74c3c;
            --color-background: #F8F9FA;
            --color-surface: #ffffff;
            --color-text: #333;
            --color-border: #dee2e6;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
            --font-headings: 'Inter', sans-serif;
            --font-body: 'Roboto', sans-serif;
        }
        html[data-theme='dark'] {
            --color-primary: #4e9ad1;
            --color-accent: #2ecc71;
            --color-background: #121212;
            --color-surface: #1e1e1e;
            --color-text: #e0e0e0;
            --color-border: #444;
        }
        body {
            font-family: var(--font-body);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container { max-width: 1800px; margin: 0 auto; }
        h1, h2, h3, h4 { color: var(--color-primary); font-family: var(--font-headings); }
        .main-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 30px; align-items: start; }
        .form-section, .preview-section { background-color: var(--color-surface); padding: 25px; border-radius: 8px; box-shadow: var(--shadow); }
        .form-group { margin-bottom: 15px; }
        .form-group-checkbox { display: flex; align-items: center; gap: 10px; }
        label { font-weight: 600; margin-bottom: 5px; display: block; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--color-border); border-radius: 8px; font-size: 1rem; box-sizing: border-box; background-color: var(--color-background); color: var(--color-text); }
        input[type="color"] { padding: 5px; height: 40px; }
        input[type="checkbox"] { width: auto; }
        .button { background-color: var(--color-accent); color: #fff; padding: 12px 28px; border: none; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 700; }
        .button.secondary { background-color: #6c757d; }
        textarea.code-output { width: 100%; min-height: 200px; font-family: monospace; font-size: 0.9em; background-color: #2b3035; color: #f8f8f2; }
        
        /* THEME SWITCH */
        .theme-switch-wrapper { display: flex; align-items: center; position: absolute; top: 20px; right: 20px; }
        .theme-switch { display: inline-block; height: 34px; position: relative; width: 60px; }
        .theme-switch input { display: none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; }
        .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 26px; left: 4px; position: absolute; transition: .4s; width: 26px; }
        input:checked+.slider { background-color: var(--color-accent); }
        input:checked+.slider:before { transform: translateX(26px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }

        /* CARD & CAROUSEL STYLES */
        .card-causa { position: relative; background-color: #fff; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); overflow: hidden; max-width: 350px; margin: auto; border: 2px solid transparent; transition: all 0.3s ease; }
        .card-causa.destacado { border-color: var(--color-donation); }
        .card-carousel-container { position: relative; width: 100%; overflow: hidden; background-color: #f0f0f0; }
        .card-carousel-slides { display: flex; transition: transform 0.4s ease-in-out; }
        .card-carousel-slide { min-width: 100%; box-sizing: border-box; position: relative; padding-bottom: 56.25%; height: 0; background-color: #000; }
        .card-carousel-slide img, .card-carousel-slide iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; border: none; }
        .carousel-btn { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.4); color: white; border: none; cursor: pointer; padding: 8px; z-index: 2; border-radius: 50%; width: 35px; height: 35px; font-size: 16px; }
        .carousel-btn.prev { left: 10px; }
        .carousel-btn.next { right: 10px; }
        .new-tag, .status-tag { position: absolute; top: 12px; color: #fff; padding: 5px 12px; border-radius: 20px; font-size: .8rem; font-weight: 700; z-index: 5; }
        .new-tag { left: 12px; background-color: var(--color-accent); }
        .status-tag { right: 12px; background-color: var(--color-urgent); }
        .status-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.85); color: #333; display: flex; justify-content: center; align-items: center; z-index: 10; font-size: 1.5rem; font-weight: 700; }
        .card-content { padding: 20px; }

        @media (max-width: 992px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="theme-switch-wrapper">
        <label class="theme-switch" for="checkbox"><input type="checkbox" id="checkbox" /><div class="slider round"></div></label>
        <em style="margin-left: 10px;">Modo Oscuro</em>
    </div>
    <div class="container">
        <h1>Painel de Controlo Centralizado</h1>
        <div class="main-grid">
            <div class="form-section">
                <h2>1. Criar Anúncio</h2>
                <form id="anuncios-form" autocomplete="off" novalidate>
                    <div class="form-group"><label for="post-type">Tipo de Anúncio</label><select id="post-type"><option value="emprego">Vaga de Emprego</option><option value="servico">Serviço Técnico</option><option value="habitacao">Habitação</option><option value="doacao">Pedido de Doação</option></select></div>
                    <div class="form-group"><label for="ad-id-number">ID do Anúncio (Ex: 25)</label><input type="number" id="ad-id-number" required></div>
                    <div class="form-group"><label for="title">Título</label><input type="text" id="title" required></div>
                    <div class="form-group"><label for="description">Descrição</label><textarea id="description" rows="4" required></textarea></div>
                    
                    <h4>Mídia (Opcional)</h4>
                    <div class="form-group"><label for="youtube-link">Link de Vídeo do YouTube</label><input type="url" id="youtube-link"></div>
                    <div class="form-group"><label for="image-input">Imagens (Máximo 5)</label><input type="file" id="image-input" accept="image/*" multiple></div>
                    
                    <h4>Detalhes de Contacto e Publicação</h4>
                    <div class="form-group"><label for="contact-phone">Telefone</label><input type="tel" id="contact-phone"></div>
                    <div class="form-group"><label for="contact-email">Email</label><input type="email" id="contact-email"></div>
                    <div class="form-group"><label for="publication-date">Data</label><input type="date" id="publication-date" required></div>
                    <div class="form-group"><label for="city">Cidade</label><input type="text" id="city" required></div>

                    <h4>Opções de Apresentação</h4>
                    <div class="form-group"><label for="ad-priority">Prioridade</label><input type="number" id="ad-priority" value="0"></div>
                    <div class="form-group"><label for="ad-status">Estado</label><select id="ad-status"><option value="disponivel">Disponível</option><option value="urgente">Urgente</option><option value="preenchido">Preenchido</option></select></div>
                    <div class="form-group"><label for="card-bg-color">Cor de Fundo</label><input type="color" id="card-bg-color" value="#FFFFFF"></div>
                    <div class="form-group form-group-checkbox"><input type="checkbox" id="is-highlighted"><label for="is-highlighted">Destacar Anúncio</label></div>
                    <div class="form-group form-group-checkbox"><input type="checkbox" id="is-new"><label for="is-new">Marcar como "Novo"</label></div>
                    
                    <button type="button" id="generate-ad-btn" class="button">Gerar Código</button>
                    <button type="button" id="clear-ad-btn" class="button secondary" style="margin-left: 15px;">Limpar</button>
                </form>
            </div>
            <div>
                <div class="preview-section">
                    <h2>2. Pré-visualização</h2>
                    <div id="capture-area"></div>
                </div>
                <div class="preview-section" style="margin-top:30px;">
                    <h2>3. Código para Copiar</h2>
                    <textarea id="generated-code-anuncio" class="code-output" readonly></textarea>
                </div>
                 <div class="preview-section" style="margin-top:30px;">
                    <h2>4. Hashtags Sugeridos</h2>
                    <textarea id="generated-hashtags" class="code-output" readonly></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const adElements = {
            youtubeLink: document.getElementById('youtube-link'),
            imageInput: document.getElementById('image-input'),
            postType: document.getElementById('post-type'),
            adIdNumber: document.getElementById('ad-id-number'),
            title: document.getElementById('title'),
            description: document.getElementById('description'),
            contactPhone: document.getElementById('contact-phone'),
            contactEmail: document.getElementById('contact-email'),
            publicationDate: document.getElementById('publication-date'),
            city: document.getElementById('city'),
            adPriority: document.getElementById('ad-priority'),
            adStatus: document.getElementById('ad-status'),
            cardBgColor: document.getElementById('card-bg-color'),
            isHighlighted: document.getElementById('is-highlighted'),
            isNew: document.getElementById('is-new'),
            captureArea: document.getElementById('capture-area'),
            generatedCode: document.getElementById('generated-code-anuncio'),
            generatedHashtags: document.getElementById('generated-hashtags'),
            generateBtn: document.getElementById('generate-ad-btn'),
            clearBtn: document.getElementById('clear-ad-btn'),
            form: document.getElementById('anuncios-form'),
        };

        let imageFiles = [];

        const updatePreview = () => {
            const formData = getAdFormData();
            if (!formData.title && imageFiles.length === 0 && !formData.youtubeUrl) {
                adElements.captureArea.innerHTML = "";
                return;
            }
            const { fullPreviewHTML } = generateAdHtmlAndSeo(formData);
            adElements.captureArea.innerHTML = fullPreviewHTML;
        };

        adElements.imageInput.addEventListener('change', (event) => {
            imageFiles = Array.from(event.target.files).slice(0, 5);
            updatePreview();
        });

        document.querySelectorAll('#anuncios-form input, #anuncios-form textarea, #anuncios-form select').forEach(el => {
            el.addEventListener('input', updatePreview);
        });

        adElements.generateBtn.addEventListener('click', () => {
            const formData = getAdFormData();
            if (!formData.title || !formData.id) {
                alert("Por favor, preencha o Título e o ID do Anúncio.");
                return;
            }
            const { cardHTML, scriptHTML, seoHTML } = generateAdHtmlAndSeo(formData);
            const hashtags = generateHashtags(formData);

            adElements.generatedCode.value = seoHTML + '\n' + cardHTML + '\n\n' + scriptHTML;
            adElements.generatedHashtags.value = hashtags;
        });

        adElements.clearBtn.addEventListener('click', () => {
            adElements.form.reset();
            adElements.publicationDate.valueAsDate = new Date();
            imageFiles = [];
            updatePreview();
            adElements.generatedCode.value = "";
            adElements.generatedHashtags.value = "";
        });

        function getYouTubeEmbedUrl(url) {
            if (!url) return null;
            let videoId;
            try {
                const urlObj = new URL(url);
                if (urlObj.hostname === 'youtu.be') videoId = urlObj.pathname.slice(1);
                else videoId = urlObj.searchParams.get('v');
            } catch (e) { return null; }
            return videoId ? `https://www.youtube.com/embed/${videoId}` : null;
        }

        function getAdFormData() {
            return {
                type: adElements.postType.value,
                id: adElements.adIdNumber.value,
                title: adElements.title.value,
                description: adElements.description.value.replace(/\n/g, '<br>'),
                phone: adElements.contactPhone.value,
                email: adElements.contactEmail.value,
                youtubeUrl: getYouTubeEmbedUrl(adElements.youtubeLink.value),
                images: imageFiles,
                pubDate: adElements.publicationDate.value,
                city: adElements.city.value,
                priority: adElements.adPriority.value || '0',
                status: adElements.adStatus.value,
                bgColor: adElements.cardBgColor.value,
                isHighlighted: adElements.isHighlighted.checked,
                isNew: adElements.isNew.checked,
            };
        }

        function generateHashtags(data) {
            const hashtags = new Set(['#portugalapoia', '#comunidade', '#solidariedade', '#portugal']);
            if (data.isNew) hashtags.add('#novidade');
            if (data.status === 'urgente') hashtags.add('#urgente');
            switch (data.type) {
                case 'emprego': hashtags.add('#emprego'); hashtags.add('#vaga'); break;
                case 'servico': hashtags.add('#servicos'); break;
                case 'habitacao': hashtags.add('#habitacao'); hashtags.add('#arrendamento'); break;
                case 'doacao': hashtags.add('#doacao'); break;
            }
            if (data.city) hashtags.add(`#${data.city.toLowerCase().replace(/\s/g, '')}`);
            data.title.split(' ').forEach(word => { if (word.length > 3) hashtags.add(`#${word.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "")}`); });
            return Array.from(hashtags).join(' ');
        }
        
        function generateAdHtmlAndSeo(data) {
            let cardIdPrefix = '', schemaType = 'Thing';
            switch (data.type) {
                case 'emprego': cardIdPrefix = 'EMP'; schemaType = 'JobPosting'; break;
                case 'servico': cardIdPrefix = 'SER'; schemaType = 'Service'; break;
                case 'habitacao': cardIdPrefix = 'HAB'; schemaType = 'Apartment'; break;
                case 'doacao': cardIdPrefix = 'DOA'; schemaType = 'Demand'; break;
            }
            const cardId = `${cardIdPrefix}-${data.id.padStart(3, '0')}`;

            let mediaItemsPreview = [], mediaItemsFinal = [];
            if (data.youtubeUrl) {
                const item = `<div class="card-carousel-slide"><iframe src="${data.youtubeUrl}" frameborder="0" allowfullscreen></iframe></div>`;
                mediaItemsPreview.push(item);
                mediaItemsFinal.push(item);
            }
            data.images.forEach(file => {
                mediaItemsPreview.push(`<div class="card-carousel-slide"><img src="${URL.createObjectURL(file)}" alt="Imagem do anúncio"></div>`);
                mediaItemsFinal.push(`<div class="card-carousel-slide"><img src="img_anuncios/${file.name.replace(/\s/g, '_')}" alt="Imagem do anúncio"></div>`);
            });

            let mediaHTMLPreview = '', mediaHTMLFinal = '';
            if (mediaItemsPreview.length > 0) {
                 const carouselId = `carousel-${Date.now()}`;
                 const createCarousel = (items) => `
                    <div class="card-carousel-container">
                        <div class="card-carousel-slides" id="${carouselId}" data-total="${items.length}">
                            ${items.join('')}
                        </div>
                        ${items.length > 1 ? `<button class="carousel-btn prev" onclick="moveSlide('${carouselId}', -1)">&#10094;</button><button class="carousel-btn next" onclick="moveSlide('${carouselId}', 1)">&#10095;</button>` : ''}
                    </div>`;
                mediaHTMLPreview = createCarousel(mediaItemsPreview);
                mediaHTMLFinal = createCarousel(mediaItemsFinal);
            }
            
            let contactHTML = '';
            if(data.phone) contactHTML += `<p><strong>Telefone:</strong> <a href="tel:${data.phone}">${data.phone}</a></p>`;
            if(data.email) contactHTML += `<p><strong>Email:</strong> <a href="mailto:${data.email}">${data.email}</a></p>`;

            let statusTagHTML = data.status === 'urgente' ? `<div class="status-tag">Urgente</div>` : '';
            let statusOverlayHTML = data.status === 'preenchido' ? `<div class="status-overlay">Preenchido</div>` : '';
            let newTagHTML = data.isNew ? `<div class="new-tag">Novo</div>` : '';

            const cardContent = `
                <div class="card-content">
                    <h3>${data.title}</h3>
                    <p>${data.description}</p>
                    ${contactHTML}
                    <p><small>#${cardId} | ${data.city}, ${data.pubDate}</small></p>
                </div>`;
            
            const cardClasses = `card-causa ${data.isHighlighted ? 'destacado' : ''}`;
            const dataAttributes = `data-publication-date="${data.pubDate}" data-city="${data.city}" data-priority="${data.priority}"`;

            const fullPreviewHTML = `<div class="${cardClasses}" style="background-color: ${data.bgColor};">${statusOverlayHTML}${newTagHTML}${statusTagHTML}${mediaHTMLPreview}${cardContent}</div>`;
            const cardHTML = `<div class="${cardClasses}" ${dataAttributes} style="background-color: ${data.bgColor};">${statusOverlayHTML}${newTagHTML}${statusTagHTML}${mediaHTMLFinal}${cardContent}</div>`;

            const schema = { "@context": "https://schema.org", "@type": schemaType, "name": data.title, "description": data.description.replace(/<br>/g, ' '), "identifier": cardId, "datePosted": data.pubDate };
            const seoHTML = `<script type="application/ld+json">\n${JSON.stringify(schema, null, 2)}\n<\/script>`;

            const scriptHTML = mediaItemsPreview.length > 1 ? `
<script>
    if (typeof window.moveSlide !== 'function') {
        window.slideStates = window.slideStates || {};
        window.moveSlide = function(carouselId, direction) {
            const slides = document.getElementById(carouselId);
            if (!slides) return;
            const totalSlides = parseInt(slides.dataset.total) || slides.children.length;
            if (window.slideStates[carouselId] === undefined) window.slideStates[carouselId] = 0;
            window.slideStates[carouselId] = (window.slideStates[carouselId] + direction + totalSlides) % totalSlides;
            slides.style.transform = \`translateX(-\${window.slideStates[carouselId] * 100}%)\`;
        }
    }
<\/script>` : '';
            
            return { cardHTML, fullPreviewHTML, scriptHTML, seoHTML };
        }

        const themeSwitch = document.getElementById('checkbox');
        themeSwitch.addEventListener('change', () => {
            const theme = themeSwitch.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        });
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme) {
            document.documentElement.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark') themeSwitch.checked = true;
        }

        adElements.publicationDate.valueAsDate = new Date();
    });
    </script>
</body>
</html>