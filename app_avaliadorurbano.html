<!DOCTYPE html>
<html lang="pt-PT">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VG454Y1YV4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-VG454Y1YV4');
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3196299619563199"
        crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliador Urbano PRO | Avaliação de Imóveis e Relatórios</title>
    <meta name="description"
        content="Software de avaliação imobiliária para profissionais. Gere relatórios completos com o método Fito-Corvini, análise de rentabilidade, SWOT e registo fotográfico. Ideal para peritos e consultores.">
    <meta name="keywords"
        content="avaliação de imóveis, avaliador imobiliário, Fito-Corvini, método comparativo, custo de reposição, relatório de avaliação, perito avaliador, software imobiliário, análise de rentabilidade, Portugal">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://portugalapoia.com/app_avaliadorurbano.html">
    <meta property="og:title" content="Avaliador Urbano PRO | Avaliação de Imóveis e Relatórios">
    <meta property="og:description"
        content="Software de avaliação imobiliária para profissionais. Gere relatórios completos com o método Fito-Corvini, análise de rentabilidade e SWOT.">
    <meta property="og:image" content="https://portugalapoia.com/images/img_portada.webp">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://portugalapoia.com/app_avaliadorurbano.html">
    <meta property="twitter:title" content="Avaliador Urbano PRO | Avaliação de Imóveis e Relatórios">
    <meta property="twitter:description"
        content="Software de avaliação imobiliária para profissionais. Gere relatórios completos com o método Fito-Corvini, análise de rentabilidade e SWOT.">
    <meta property="twitter:image" content="https://portugalapoia.com/images/img_portada.webp">

    <link rel="canonical" href="https://portugalapoia.com/app_avaliadorurbano.html">
    
    <link rel="apple-touch-icon" href="images_pta/logofavicon.ico">
    <link rel="icon" href="images_pta/logofavicon.ico" type="image/png">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" media="print"
        onload="this.media='all'">
    <noscript>
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;500&display=swap">
    </noscript>
    
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    </noscript>
    <link rel="stylesheet" href="avaliador-urbano-style.css" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="avaliador-urbano-style.css">
        
    </noscript>
    

    <style>
        .annual-costs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .total-costs-display {
            background-color: #e9ecef;
            border-radius: var(--border-radius-main);
            padding: 10px 15px;
            text-align: right;
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 15px;
        }

        body.dark-theme .total-costs-display {
            background-color: #343a40;
        }

        .transport-item {
            display: grid;
            grid-template-columns: auto 1fr 1fr 100px;
            gap: 15px;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .transport-item:last-child {
            border-bottom: none;
        }

        .transport-item .icon-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .transport-item i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .location-upload-grid {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .location-upload-box {
            flex: 1;
            text-align: center;
        }

        .location-arrow {
            font-size: 2.5rem;
            color: var(--border-color);
        }

        .image-upload-box {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-main);
            padding: 1rem;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: border-color 0.3s, background-color 0.3s;
        }

        .image-upload-box:hover {
            border-color: var(--primary-color);
            background-color: #f8f9fa;
        }

        .image-upload-box i {
            font-size: 2.5rem;
            color: #adb5bd;
            margin-bottom: 0.5rem;
        }

        .image-upload-box img {
            max-width: 100%;
            max-height: 150px;
            border-radius: var(--border-radius-main);
        }

        @media (max-width: 768px) {
            .transport-item {
                grid-template-columns: 1fr;
            }

            .location-upload-grid {
                flex-direction: column;
            }

            .location-arrow {
                transform: rotate(90deg);
            }
        }

        @media print {
            @page {
                size: A4;
                margin: 1.5cm;
            }

            body,
            .avaliador-urbano-container,
            .modal-content {
                background-color: #fff !important;
                box-shadow: none !important;
                border: none !important;
                color: #000 !important;
            }

            .modal-header,
            .modal-footer,
            .main-header,
            main>section:first-of-type,
            form,
            footer {
                display: none !important;
            }

            .modal {
                position: static !important;
                display: block !important;
                overflow: visible !important;
            }

            .modal-dialog {
                max-width: 100% !important;
                margin: 0 !important;
            }

            .modal-body {
                padding: 0 !important;
            }

            .report-page {
                page-break-after: always;
            }

            .report-page:last-child {
                page-break-after: auto;
            }

            .report-section,
            .photo-block {
                page-break-inside: avoid;
            }

            .photo-report-section {
                page-break-before: always;
            }

            .photo-block {
                width: 100%;
                margin-bottom: 1cm;
            }

            .photo-block img {
                max-width: 100%;
                max-height: 20cm;
                border: 1px solid #ccc;
            }

            .chart-container {
                width: 100% !important;
                max-width: 18cm !important;
                height: auto !important;
                margin: 20px auto;
            }

            canvas {
                max-width: 100% !important;
            }
        }
    </style>
</head>

<body>
    <div id="preloader"><img src="images_pta/logocuadrado.jpg" alt="A carregar..." class="spinner"></div>

    <header class="main-header">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand logo" href="index.html" style="display: inline-flex; align-items: center;">
                    <img src="images_pta/logocuadrado.jpg" alt="Logo PortugalApoia"
                        style="height: 35px; margin-right: 10px;">
                    <span class="brand-text-responsive">PortugalApoia</span>
                </a>

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="main-nav">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item"><a class="nav-link" href="doacoes.html">Doações</a></li>
                        <li class="nav-item"><a class="nav-link" href="empregos.html">Emprego</a></li>
                        <li class="nav-item"><a class="nav-link" href="servicos.html">Serviços</a></li>
                        <li class="nav-item"><a class="nav-link" href="habitação.html">Habitação</a></li>
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownWebApp" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Apps
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdownWebApp">
                                <a class="dropdown-item" href="app_evaluadorsustentable.html">Avaliador Sustentável
                                    PRO</a>
                                <a class="dropdown-item" href="app_avaliadorurbano.html">Avaliador de Imóveis
                                    Urbanos</a>
                            </div>
                        </li>
                        <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
                        <li class="nav-item"><a class="nav-link btn btn-primary publish-btn"
                                href="publicar.html">Publicar</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="page-header page-header-avaliador-urbano text-center">
            <div class="container">
                <h1 class="page-title">Avaliador Urbano PRO</h1>
                <p class="lead">Ferramenta avançada para avaliações comerciais de imóveis urbanos com relatórios
                    detalhados.</p>
            </div>
        </section>

        <div class="avaliador-urbano-container my-5">
            <form id="avaliador-urbano-app" onsubmit="return false;">

                <div class="form-section">
                    <h3>1. Dados Gerais da Avaliação</h3>
                    <div class="form-group">
                        <label for="nomeSolicitante">Identificação do Solicitante</label>
                        <input type="text" class="form-control" id="nomeSolicitante"
                            placeholder="Nome e identificação do solicitante">
                    </div>
                    <div class="form-group">
                        <label for="nomeAvaliador">Identificação do Avaliador</label>
                        <input type="text" class="form-control" id="nomeAvaliador" placeholder="Nome do avaliador">
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="idAvaliador">Nº de Cédula</label>
                            <input type="text" class="form-control" id="idAvaliador" placeholder="Ex: 123456789">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="regAvaliador">Nº de Registo</label>
                            <input type="text" class="form-control" id="regAvaliador" placeholder="Ex: CMVM/0001">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="objetoAvaliacao">Objeto da Avaliação</label>
                        <textarea class="form-control" id="objetoAvaliacao" rows="2"
                            placeholder="Descreva o propósito da avaliação (ex: compra e venda, garantia hipotecária, etc.)."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="dataVisita">Data da Visita</label>
                            <input type="date" class="form-control" id="dataVisita">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="dataRelatorio">Data do Relatório</label>
                            <input type="date" class="form-control" id="dataRelatorio">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>2. Tipo e Detalhes do Imóvel</h3>
                    <div class="form-group">
                        <label for="tipoInmueble">Tipo de Imóvel</label>
                        <select class="form-control" id="tipoInmueble">
                            <option value="selecione">Selecione o tipo...</option>
                            <option value="Apartamento">Apartamento</option>
                            <option value="Moradia">Moradia</option>
                            <option value="Terreno">Terreno Urbano</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>3. Morada do Imóvel</h3>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="cidadeImovel">Cidade</label>
                            <select class="form-control" id="cidadeImovel"></select>
                        </div>
                        <div class="form-group col-md-6"><label for="codigoPostalImovel">Código Postal</label><input
                                type="text" class="form-control" id="codigoPostalImovel" placeholder="Ex: 4000-447">
                        </div>
                    </div>
                    <div class="form-group"><label for="moradaImovel">Morada Completa</label><input type="text"
                            class="form-control" id="moradaImovel" placeholder="Ex: Rua de Santa Catarina, 123"></div>
                </div>

                <div class="form-section">
                    <h3>4. Localização Gráfica <i class="fas fa-map-marked-alt"></i></h3>
                    <div class="location-upload-grid">
                        <div class="location-upload-box">
                            <label for="loc-pais" class="w-100">
                                <div class="image-upload-box" id="preview-loc-pais">
                                    <i class="fas fa-globe-europe"></i>
                                    <span>Localização do País</span>
                                </div>
                            </label>
                            <input type="file" id="loc-pais" class="d-none" accept="image/*">
                        </div>
                        <div class="location-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                        <div class="location-upload-box">
                            <label for="loc-cidade" class="w-100">
                                <div class="image-upload-box" id="preview-loc-cidade">
                                    <i class="fas fa-city"></i>
                                    <span>Localização da Cidade</span>
                                </div>
                            </label>
                            <input type="file" id="loc-cidade" class="d-none" accept="image/*">
                        </div>
                        <div class="location-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                        <div class="location-upload-box">
                            <label for="loc-bairro" class="w-100">
                                <div class="image-upload-box" id="preview-loc-bairro">
                                    <i class="fas fa-map-pin"></i>
                                    <span>Localização do Bairro</span>
                                </div>
                            </label>
                            <input type="file" id="loc-bairro" class="d-none" accept="image/*">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>5. Características do Imóvel <i class="fas fa-home"></i></h3>
                    <div class="form-group highlighted-input-group"><label for="area-construcao">Área Bruta Privativa
                            (m²)</label><input type="number" id="area-construcao" min="0" class="form-control"
                            placeholder="Introduza a área total de construção"></div>
                    <div class="property-features-grid">
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-bed"></i></div><label for="qtd-quartos"
                                class="feature-label">Quartos</label>
                            <div class="feature-quantity"><input type="number" id="qtd-quartos" name="qtd_quartos"
                                    min="0" value="3" class="form-control"></div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-bath"></i></div><label for="qtd-banos"
                                class="feature-label">Casa de Banho</label>
                            <div class="feature-quantity"><input type="number" id="qtd-banos" name="qtd_banos" min="0"
                                    value="2" class="form-control"></div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-car"></i></div><label for="qtd-garagem"
                                class="feature-label">Garagem (vagas)</label>
                            <div class="feature-quantity"><input type="number" id="qtd-garagem" name="qtd_garagem"
                                    min="0" value="1" class="form-control"></div>
                        </div>
                    </div>
                    <hr>
                    <div class="property-features-grid mt-4">
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-utensils"></i></div>
                            <label class="feature-label">Cozinha</label>
                            <div class="custom-control custom-checkbox"><input type="checkbox"
                                    class="custom-control-input" id="check-cozinha"><label class="custom-control-label"
                                    for="check-cozinha">Incluído</label></div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-tshirt"></i></div>
                            <label class="feature-label">Lavandaria</label>
                            <div class="custom-control custom-checkbox"><input type="checkbox"
                                    class="custom-control-input" id="check-lavandaria"><label
                                    class="custom-control-label" for="check-lavandaria">Incluído</label></div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fas fa-mountain-sun"></i></div>
                            <label class="feature-label">Varanda/Terraço</label>
                            <div class="custom-control custom-checkbox"><input type="checkbox"
                                    class="custom-control-input" id="check-terraco"><label class="custom-control-label"
                                    for="check-terraco">Incluído</label></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>6. Infraestrutura e Serviços <i class="fas fa-broadcast-tower"></i></h3>
                    <h4 class="h5">Serviços Públicos</h4>
                    <div class="public-services-grid">
                        <div class="service-item"><i class="fas fa-faucet service-icon"></i><label
                                class="service-label">Água Canalizada</label>
                            <div class="service-toggle"><input type="radio" id="serv-agua-sim" name="serv-agua"
                                    value="sim" checked><label for="serv-agua-sim">Sim</label><input type="radio"
                                    id="serv-agua-nao" name="serv-agua" value="nao"><label
                                    for="serv-agua-nao">Não</label></div>
                        </div>
                        <div class="service-item"><i class="fas fa-bolt service-icon"></i><label
                                class="service-label">Eletricidade</label>
                            <div class="service-toggle"><input type="radio" id="serv-ele-sim" name="serv-ele"
                                    value="sim" checked><label for="serv-ele-sim">Sim</label><input type="radio"
                                    id="serv-ele-nao" name="serv-ele" value="nao"><label for="serv-ele-nao">Não</label>
                            </div>
                        </div>
                        <div class="service-item"><i class="fas fa-fire-flame-simple service-icon"></i><label
                                class="service-label">Gás Natural</label>
                            <div class="service-toggle"><input type="radio" id="serv-gas-sim" name="serv-gas"
                                    value="sim"><label for="serv-gas-sim">Sim</label><input type="radio"
                                    id="serv-gas-nao" name="serv-gas" value="nao" checked><label
                                    for="serv-gas-nao">Não</label></div>
                        </div>
                        <div class="service-item"><i class="fas fa-toilet service-icon"></i><label
                                class="service-label">Saneamento</label>
                            <div class="service-toggle"><input type="radio" id="serv-san-sim" name="serv-san"
                                    value="sim" checked><label for="serv-san-sim">Sim</label><input type="radio"
                                    id="serv-san-nao" name="serv-san" value="nao"><label for="serv-san-nao">Não</label>
                            </div>
                        </div>
                        <div class="service-item"><i class="fas fa-wifi service-icon"></i><label
                                class="service-label">Internet Fibra</label>
                            <div class="service-toggle"><input type="radio" id="serv-net-sim" name="serv-net"
                                    value="sim"><label for="serv-net-sim">Sim</label><input type="radio"
                                    id="serv-net-nao" name="serv-net" value="nao" checked><label
                                    for="serv-net-nao">Não</label></div>
                        </div>
                    </div>

                    <h4 class="h5 mt-4">Vias de Acesso</h4>
                    <div class="form-group">
                        <label for="vias-acesso"><i class="fas fa-road mr-2"></i>Nomes das principais vias de
                            acesso</label>
                        <textarea id="vias-acesso" class="form-control" rows="3"
                            placeholder="Ex: A1, VCI, Avenida da Boavista..."></textarea>
                    </div>

                    <h4 class="h5 mt-4">Transporte Público Próximo</h4>
                    <div id="transport-list">
                        <div class="transport-item">
                            <div class="icon-label"><input type="checkbox" class="form-check-input" id="check-metro"><i
                                    class="fas fa-train-subway"></i><span>Metro</span></div><input type="text"
                                class="form-control" placeholder="Estação mais próxima"><input type="number"
                                class="form-control" placeholder="Distância (m)">
                        </div>
                        <div class="transport-item">
                            <div class="icon-label"><input type="checkbox" class="form-check-input"
                                    id="check-autocarro"><i class="fas fa-bus"></i><span>Autocarro</span></div><input
                                type="text" class="form-control" placeholder="Paragem mais próxima"><input type="number"
                                class="form-control" placeholder="Distância (m)">
                        </div>
                        <div class="transport-item">
                            <div class="icon-label"><input type="checkbox" class="form-check-input"
                                    id="check-comboio"><i class="fas fa-train"></i><span>Comboio</span></div><input
                                type="text" class="form-control" placeholder="Estação mais próxima"><input type="number"
                                class="form-control" placeholder="Distância (m)">
                        </div>
                        <div class="transport-item">
                            <div class="icon-label"><input type="checkbox" class="form-check-input"
                                    id="check-eletrico"><i class="fas fa-train-tram"></i><span>Elétrico</span></div>
                            <input type="text" class="form-control" placeholder="Paragem mais próxima"><input
                                type="number" class="form-control" placeholder="Distância (m)">
                        </div>
                        <div class="transport-item">
                            <div class="icon-label"><input type="checkbox" class="form-check-input" id="check-barco"><i
                                    class="fas fa-ferry"></i><span>Barco/Ferry</span></div><input type="text"
                                class="form-control" placeholder="Cais mais próximo"><input type="number"
                                class="form-control" placeholder="Distância (m)">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>7. Acabamentos e Materiais de Construção</h3>
                    <div class="finishes-grid">
                        <div class="finish-item">
                            <div class="finish-icon"><i class="fas fa-border-style"></i></div><label
                                class="finish-label">Muros / Paredes</label><select class="form-control mb-2"
                                id="material_muros">
                                <option>Tijolo</option>
                                <option>Bloco de Betão</option>
                                <option>Betão Armado</option>
                                <option>Drywall (Gesso)</option>
                                <option>Madeira</option>
                            </select>
                            <div class="evaluation-group"><label><input type="radio" name="estado_muros" value="bom"
                                        checked>
                                    Bom</label><label><input type="radio" name="estado_muros" value="regular">
                                    Regular</label><label><input type="radio" name="estado_muros" value="mau">
                                    Mau</label></div>
                        </div>
                        <div class="finish-item">
                            <div class="finish-icon"><i class="fas fa-palette"></i></div><label
                                class="finish-label">Revestimentos</label><select class="form-control mb-2"
                                id="material_revestimentos">
                                <option>Pintura Plástica</option>
                                <option>Cerâmica</option>
                                <option>Papel de Parede</option>
                                <option>Madeira</option>
                            </select>
                            <div class="evaluation-group"><label><input type="radio" name="estado_revestimentos"
                                        value="bom" checked> Bom</label><label><input type="radio"
                                        name="estado_revestimentos" value="regular"> Regular</label><label><input
                                        type="radio" name="estado_revestimentos" value="mau"> Mau</label></div>
                        </div>
                        <div class="finish-item">
                            <div class="finish-icon"><i class="fas fa-shoe-prints"></i></div><label
                                class="finish-label">Pisos</label><select class="form-control mb-2" id="material_pisos">
                                <option>Cerâmica</option>
                                <option>Soalho Flutuante</option>
                                <option>Madeira Maciça</option>
                                <option>Mármore/Granito</option>
                            </select>
                            <div class="evaluation-group"><label><input type="radio" name="estado_pisos" value="bom"
                                        checked>
                                    Bom</label><label><input type="radio" name="estado_pisos" value="regular">
                                    Regular</label><label><input type="radio" name="estado_pisos" value="mau">
                                    Mau</label></div>
                        </div>
                        <div class="finish-item">
                            <div class="finish-icon"><i class="fas fa-door-closed"></i></div><label
                                class="finish-label">Carpintaria</label><select class="form-control mb-2"
                                id="material_carpintaria">
                                <option>Madeira Maciça</option>
                                <option>MDF Lacado</option>
                                <option>Alumínio</option>
                                <option>PVC</option>
                            </select>
                            <div class="evaluation-group"><label><input type="radio" name="estado_carpintaria"
                                        value="bom" checked>
                                    Bom</label><label><input type="radio" name="estado_carpintaria" value="regular">
                                    Regular</label><label><input type="radio" name="estado_carpintaria" value="mau">
                                    Mau</label></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>8. Análise Qualitativa (SWOT)</h3>
                    <div class="form-group">
                        <label for="swot-strengths"><strong><i class="fas fa-thumbs-up text-success"></i> Pontos Fortes
                                (Strengths)</strong></label>
                        <textarea id="swot-strengths" class="form-control" rows="3"
                            placeholder="Ex: Localização central, boa exposição solar, acabamentos de alta qualidade..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="swot-weaknesses"><strong><i class="fas fa-thumbs-down text-danger"></i> Pontos
                                Fracos (Weaknesses)</strong></label>
                        <textarea id="swot-weaknesses" class="form-control" rows="3"
                            placeholder="Ex: Necessita de remodelação, ausência de garagem, fraco isolamento acústico..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="swot-opportunities"><strong><i class="fas fa-lightbulb text-info"></i> Oportunidades
                                (Opportunities)</strong></label>
                        <textarea id="swot-opportunities" class="form-control" rows="3"
                            placeholder="Ex: Nova linha de metro nas proximidades, valorização da zona, potencial para arrendamento turístico..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="swot-threats"><strong><i class="fas fa-exclamation-triangle text-warning"></i>
                                Ameaças (Threats)</strong></label>
                        <textarea id="swot-threats" class="form-control" rows="3"
                            placeholder="Ex: Excesso de oferta na zona, restrições urbanísticas, degradação da vizinhança..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>9. Registo Fotográfico (Anexos)</h3>
                    <p class="text-muted">Anexe até 20 fotografias do imóvel. Apenas as fotografias carregadas
                        aparecerão no relatório.</p>
                    <div id="photo-upload-container"></div>
                    <button type="button" id="add-photo-btn" class="btn btn-secondary mt-3"><i class="fas fa-plus"></i>
                        Adicionar Fotografia</button>
                </div>

                <div class="form-section">
                    <h3>10. Método de Valorização</h3>
                    <div id="terrain-valuation" class="conditional-details" style="display: block;">
                        <h4 class="h5">10.1 Valorização do Terreno</h4>
                        <p><strong>Método Utilizado:</strong> Método Comparativo de Mercado</p>
                        <div class="form-group highlighted-input-group"><label for="area-terreno-imovel">Área do Terreno
                                do Imóvel (m²)</label><input type="number" id="area-terreno-imovel" min="0"
                                class="form-control" placeholder="Introduza a área do seu terreno"></div>
                        <div class="table-responsive">
                            <table id="terrain-comparison-table" class="table table-bordered table-hover">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Amostra</th>
                                        <th>Localização da Amostra</th>
                                        <th>Área (m²)</th>
                                        <th>Valor por m² (€)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="number" min="0" class="form-control"></td>
                                        <td><input type="number" min="0" class="form-control"></td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="number" min="0" class="form-control"></td>
                                        <td><input type="number" min="0" class="form-control"></td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="number" min="0" class="form-control"></td>
                                        <td><input type="number" min="0" class="form-control"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="construction-valuation">
                        <h4 class="h5 mt-4">10.2 Valorização da Construção</h4>
                        <p><strong>Método Utilizado:</strong> Custo de Reposição (Fito-Corvini)</p>
                        <div class="form-row">
                            <div class="form-group col-md-6 highlighted-input-group">
                                <label for="custo-direto">Custos Diretos (CD) por m² (€)</label>
                                <div class="input-group">
                                    <input type="number" id="custo-direto" min="0" class="form-control"
                                        placeholder="Ex: 1350">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" id="suggested-cost-btn"
                                            title="Usar custo médio sugerido">Sugerir</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-6 highlighted-input-group">
                                <label for="custo-indireto">Custos Indiretos (CI) - % de CD</label>
                                <input type="number" id="custo-indireto" min="0" max="100" class="form-control"
                                    placeholder="Ex: 25" value="25">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6 highlighted-input-group">
                                <label for="beneficio">Benefício (B) - % de (CD+CI)</label>
                                <input type="number" id="beneficio" min="0" max="100" class="form-control"
                                    placeholder="Ex: 10" value="10">
                            </div>
                            <div class="form-group col-md-6 highlighted-input-group">
                                <label for="depreciacao">Depreciação (D) - % do VC</label>
                                <div class="input-group">
                                    <input type="number" id="depreciacao" min="0" max="100" class="form-control"
                                        placeholder="Calcular com Fito-Corvini">
                                    <div class="input-group-append">
                                        <button class="btn btn-secondary" type="button" id="openFitoCorviniModal"
                                            title="Calcular Depreciação com Tabela de Fito-Corvini"><i
                                                class="fas fa-calculator"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="valuation-results-box mt-4">
                        <div class="result-item"><span>Custo de Reposição (CR) da Construção:</span><strong
                                id="total-construction-value">€ 0,00</strong></div>
                        <div class="result-item"><span>(+) Valor Estimado do Terreno:</span><strong
                                id="total-terrain-value">€ 0,00</strong></div>
                        <div class="result-item final-value"><span>(=) Valor Total Estimado do Imóvel:</span><strong
                                id="total-property-value">€ 0,00</strong></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>11. Análise de Rentabilidade (Arrendamento)</h3>
                    <div class="form-group">
                        <label for="acquisition-value">Valor de Aquisição (Baseado no Valor Total do Avalúo)</label>
                        <input type="number" id="acquisition-value" class="form-control"
                            placeholder="Calculado automaticamente" readonly>
                    </div>

                    <div class="form-group">
                        <label>Custos Anuais</label>
                        <div class="annual-costs-grid">
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">IMI</span></div>
                                <input type="number" class="form-control annual-cost-input" id="cost-imi"
                                    placeholder="€">
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">Condomínio</span></div>
                                <input type="number" class="form-control annual-cost-input" id="cost-condo"
                                    placeholder="€">
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">Seguro</span></div>
                                <input type="number" class="form-control annual-cost-input" id="cost-seguro"
                                    placeholder="€">
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">Manutenção</span></div>
                                <input type="number" class="form-control annual-cost-input" id="cost-manutencao"
                                    placeholder="€">
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">Outras</span></div>
                                <input type="number" class="form-control annual-cost-input" id="cost-outras"
                                    placeholder="€">
                            </div>
                        </div>
                        <div class="total-costs-display">
                            <span>Total de Custos Anuais:</span>
                            <strong id="total-annual-costs-display">€ 0,00</strong>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="rent-city">Cidade para Cálculo da Renda</label>
                        <div class="input-group">
                            <select id="rent-city" class="form-control"></select>
                            <div class="input-group-append">
                                <span class="input-group-text" id="rent-yield-display">0.0% Yield Anual</span>
                            </div>
                        </div>
                    </div>
                    <div id="profitability-results" class="valuation-results-box mt-4" style="display:none;">
                        <div class="result-item"><span>Rentabilidade Bruta Anual (Yield):</span><strong
                                id="gross-yield-result">0.00%</strong></div>
                        <div class="result-item"><span>Renda Mensal Estimada:</span><strong id="monthly-rent-result">€
                                0,00</strong></div>
                        <div class="result-item"><span>Retorno Sobre o Investimento (ROI) Anual:</span><strong
                                id="roi-result">0.00%</strong></div>
                        <div class="result-item final-value"><span>Tempo de Retorno da Inversão:</span><strong
                                id="payback-result">N/A</strong></div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>12. Conclusões e Observações Finais</h3>
                    <div class="form-group">
                        <label for="final-remarks">Parecer Final do Avaliador</label>
                        <textarea id="final-remarks" class="form-control" rows="5"
                            placeholder="Descreva as suas conclusões finais sobre o valor, estado e potencial do imóvel."></textarea>
                    </div>
                </div>


                <button type="submit" class="submit-button">Gerar Relatório de Avaliação</button>
            </form>
        </div>
    </main>

    <footer class="main-footer"></footer>

    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Relatório de Avaliação de Imóvel</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="reportOutput"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="printReport();"><i
                            class="fas fa-print mr-2"></i>Imprimir Relatório</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="fitoCorviniModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fitoCorviniModalLabel">Calculadora de Depreciação (Fito-Corvini)</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-success" id="applyFitoValue">Aplicar %</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="costSuggestionModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Assistente de Custo de Construção (€/m²)</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="cost-district">Distrito</label>
                        <select id="cost-district" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label for="cost-quality">Qualidade dos Acabamentos</label>
                        <select id="cost-quality" class="form-control">
                            <option value="Económica">Económica</option>
                            <option value="Regular" selected>Regular</option>
                            <option value="Luxo">Luxo</option>
                        </select>
                    </div>
                    <div class="mt-4 text-center">
                        <h5>Valor Sugerido:</h5>
                        <h3 id="suggested-cost-display" class="font-weight-bold">€ 0,00</h3>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="applySuggestedCost">Aplicar Valor</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="script.js" defer></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // --- DATABASE & GLOBAL VARS ---
            const RENTAL_YIELDS = {
                "Aveiro": 6.2, "Beja": 7.0, "Braga": 6.5, "Bragança": 8.4, "Castelo Branco": 8.6,
                "Coimbra": 6.9, "Évora": 6.0, "Faro": 5.5, "Funchal (Madeira)": 6.1, "Guarda": 6.7,
                "Leiria": 6.3, "Lisboa": 4.7, "Ponta Delgada (Açores)": 5.8, "Portalegre": 6.9,
                "Porto": 5.7, "Santarém": 7.5, "Setúbal": 5.4, "Viana do Castelo": 6.9,
                "Vila Real": 6.4, "Viseu": 7.9, "Outra": 6.0
            };
            const FITO_CORVINI_DATA = {
                estados: ["Novo", "Como Novo", "Ligeiramente Degradado", "Reparação Simples", "Reparação Importante", "Ruinoso"],
                idades: ["0-5", "6-10", "11-20", "21-30", "31-40", "41-50", ">50"],
                valores: [[0, 1, 5, 10, 20, 35, 50], [0, 2, 8, 15, 25, 40, 55], [0, 5, 12, 20, 30, 45, 60], [0, 8, 16, 25, 35, 50, 65], [0, 10, 20, 30, 40, 55, 70], [80, 80, 80, 85, 90, 95, 100]]
            };
            const DISTRICT_ZONES = { 'Aveiro': 'Zona II', 'Beja': 'Zona III', 'Braga': 'Zona II', 'Bragança': 'Zona III', 'Castelo Branco': 'Zona III', 'Coimbra': 'Zona II', 'Évora': 'Zona III', 'Faro': 'Zona I', 'Guarda': 'Zona III', 'Leiria': 'Zona II', 'Lisboa': 'Zona I', 'Portalegre': 'Zona III', 'Porto': 'Zona I', 'Santarém': 'Zona III', 'Setúbal': 'Zona II', 'Viana do Castelo': 'Zona III', 'Vila Real': 'Zona III', 'Viseu': 'Zona III', 'Açores': 'Zona II', 'Madeira': 'Zona II' };
            const COST_BY_ZONE_QUALITY = {
                'Zona I': { 'Económica': 925, 'Regular': 1250, 'Luxo': 1600 },
                'Zona II': { 'Económica': 808, 'Regular': 1100, 'Luxo': 1400 },
                'Zona III': { 'Económica': 732, 'Regular': 950, 'Luxo': 1200 }
            };

            let photoCounter = 0;
            const MAX_PHOTOS = 20;
            let valueBreakdownChart, profitabilityChart, valuationComparisonChart, annualCostsChart;

            // --- FORM & MODAL INITIALIZATION ---
            function initializeForm() {
                const cidadeImovelSelect = document.getElementById('cidadeImovel');
                const rentCitySelect = document.getElementById('rent-city');
                const cities = Object.keys(RENTAL_YIELDS).sort();

                cities.forEach(city => {
                    const option1 = document.createElement('option');
                    option1.value = city;
                    option1.textContent = city;
                    cidadeImovelSelect.appendChild(option1);

                    const option2 = document.createElement('option');
                    option2.value = city;
                    option2.textContent = city;
                    rentCitySelect.appendChild(option2);
                });

                const districtSelect = document.getElementById('cost-district');
                Object.keys(DISTRICT_ZONES).sort().forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });

                document.getElementById('add-photo-btn').click();
                updateYieldDisplay();
            }

            function createPhotoInput(index) {
                const photoUploadContainer = document.getElementById('photo-upload-container');
                const div = document.createElement('div');
                div.className = 'photo-input-group border rounded p-3 mb-3';
                div.innerHTML = `
                    <div class="form-row">
                        <div class="form-group col-md-5 mb-md-0">
                            <label for="photo-file-${index}">Fotografia ${index}</label>
                            <input type="file" class="form-control-file photo-file" id="photo-file-${index}" data-index="${index}" accept="image/*">
                            <div class="mt-2" id="photo-preview-${index}" style="max-height: 150px; overflow: hidden;"></div>
                        </div>
                        <div class="form-group col-md-7 mb-0">
                            <label for="photo-desc-${index}">Descrição da Fotografia</label>
                            <textarea class="form-control photo-desc" id="photo-desc-${index}" rows="4" placeholder="Ex: Fachada principal, vista da varanda, etc."></textarea>
                        </div>
                    </div>`;
                photoUploadContainer.appendChild(div);

                document.getElementById(`photo-file-${index}`).addEventListener('change', function (e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const previewContainer = document.getElementById(`photo-preview-${index}`);
                    previewContainer.innerHTML = '';
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.maxWidth = '100%';
                        img.style.maxHeight = '150px';
                        img.style.objectFit = 'cover';
                        previewContainer.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            }

            // --- CALCULATOR LOGIC ---
            function setupCalculators() {
                document.getElementById('openFitoCorviniModal').addEventListener('click', () => {
                    const modalBody = document.querySelector('#fitoCorviniModal .modal-body');
                    let tableHTML = '<div class="table-responsive"><table class="table table-bordered text-center">';
                    tableHTML += '<thead><tr><th>Idade \\ Estado</th>';
                    FITO_CORVINI_DATA.estados.forEach(estado => tableHTML += `<th>${estado}</th>`);
                    tableHTML += '</tr></thead><tbody>';
                    FITO_CORVINI_DATA.idades.forEach((idade, i) => {
                        tableHTML += `<tr><th>${idade}</th>`;
                        FITO_CORVINI_DATA.valores.forEach((coluna, j) => {
                            const value = FITO_CORVINI_DATA.valores[j][i];
                            tableHTML += `<td><div class="custom-control custom-radio"><input type="radio" id="fito-${i}-${j}" name="fito-value" class="custom-control-input" value="${value}"><label class="custom-control-label" for="fito-${i}-${j}">${value}%</label></div></td>`;
                        });
                        tableHTML += '</tr>';
                    });
                    tableHTML += '</tbody></table></div>';
                    modalBody.innerHTML = tableHTML;
                    $('#fitoCorviniModal').modal('show');
                });

                document.getElementById('applyFitoValue').addEventListener('click', () => {
                    const selected = document.querySelector('input[name="fito-value"]:checked');
                    if (selected) {
                        document.getElementById('depreciacao').value = selected.value;
                        calculateAndDisplayAll();
                    }
                    $('#fitoCorviniModal').modal('hide');
                });

                const costDistrict = document.getElementById('cost-district');
                const costQuality = document.getElementById('cost-quality');
                const suggestedCostDisplay = document.getElementById('suggested-cost-display');

                function updateSuggestedCost() {
                    const district = costDistrict.value;
                    const quality = costQuality.value;
                    const zone = DISTRICT_ZONES[district];
                    const cost = COST_BY_ZONE_QUALITY[zone][quality];
                    suggestedCostDisplay.textContent = `€ ${cost.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    suggestedCostDisplay.dataset.cost = cost;
                }

                document.getElementById('suggested-cost-btn').addEventListener('click', () => {
                    updateSuggestedCost();
                    $('#costSuggestionModal').modal('show');
                });

                costDistrict.addEventListener('change', updateSuggestedCost);
                costQuality.addEventListener('change', updateSuggestedCost);

                document.getElementById('applySuggestedCost').addEventListener('click', () => {
                    const cost = suggestedCostDisplay.dataset.cost;
                    if (cost) {
                        document.getElementById('custo-direto').value = cost;
                        calculateAndDisplayAll();
                    }
                    $('#costSuggestionModal').modal('hide');
                });
            }

            function updateTotalAnnualCosts() {
                let total = 0;
                document.querySelectorAll('.annual-cost-input').forEach(input => {
                    total += parseFloat(input.value) || 0;
                });
                document.getElementById('total-annual-costs-display').textContent = `€ ${total.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                calculateAndDisplayAll();
            }

            function updateYieldDisplay() {
                const city = document.getElementById('rent-city').value;
                const yieldValue = RENTAL_YIELDS[city] || 0;
                document.getElementById('rent-yield-display').textContent = `${yieldValue.toFixed(1)}% Yield Anual`;
            }

            // --- MAIN CALCULATION FUNCTION ---
            function calculateAndDisplayAll() {
                let terrainValue = 0;
                const terrainArea = parseFloat(document.getElementById('area-terreno-imovel').value) || 0;
                let totalValM2 = 0, sampleCount = 0;
                document.querySelectorAll('#terrain-comparison-table tbody tr').forEach(row => {
                    const valM2 = parseFloat(row.cells[3].querySelector('input').value);
                    if (!isNaN(valM2) && valM2 > 0) {
                        totalValM2 += valM2;
                        sampleCount++;
                    }
                });
                const avgValM2 = sampleCount > 0 ? totalValM2 / sampleCount : 0;
                terrainValue = terrainArea * avgValM2;
                document.getElementById('total-terrain-value').textContent = `€ ${terrainValue.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                const constructionArea = parseFloat(document.getElementById('area-construcao').value) || 0;
                const cd = parseFloat(document.getElementById('custo-direto').value) || 0;
                const ci = (parseFloat(document.getElementById('custo-indireto').value) || 0) / 100;
                const b = (parseFloat(document.getElementById('beneficio').value) || 0) / 100;
                const d = (parseFloat(document.getElementById('depreciacao').value) || 0) / 100;
                const vc = cd * (1 + ci) * (1 + b) * constructionArea;
                const constructionValue = vc * (1 - d);
                document.getElementById('total-construction-value').textContent = `€ ${constructionValue.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                const totalPropertyValue = terrainValue + constructionValue;
                document.getElementById('total-property-value').textContent = `€ ${totalPropertyValue.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                document.getElementById('acquisition-value').value = totalPropertyValue > 0 ? totalPropertyValue.toFixed(2) : '';

                const acquisitionValue = totalPropertyValue;

                let totalAnnualCosts = 0;
                document.querySelectorAll('.annual-cost-input').forEach(input => {
                    totalAnnualCosts += parseFloat(input.value) || 0;
                });

                const selectedCity = document.getElementById('rent-city').value;
                const yieldPercent = RENTAL_YIELDS[selectedCity] || 0;

                if (acquisitionValue > 0) {
                    const grossAnnualRent = acquisitionValue * (yieldPercent / 100);
                    const netAnnualRent = grossAnnualRent - totalAnnualCosts;
                    const roi = (netAnnualRent / acquisitionValue) * 100;
                    const monthlyRent = grossAnnualRent / 12;
                    let paybackYears = 'N/A';
                    if (netAnnualRent > 0) {
                        const years = acquisitionValue / netAnnualRent;
                        paybackYears = `${years.toFixed(1)} Anos`;
                    }
                    document.getElementById('gross-yield-result').textContent = `${yieldPercent.toFixed(2)}%`;
                    document.getElementById('monthly-rent-result').textContent = `€ ${monthlyRent.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    document.getElementById('roi-result').textContent = `${roi.toFixed(2)}%`;
                    document.getElementById('payback-result').textContent = paybackYears;
                    document.getElementById('profitability-results').style.display = 'block';
                } else {
                    document.getElementById('profitability-results').style.display = 'none';
                }
            }

            // --- EVENT LISTENERS ---
            function setupEventListeners() {
                const fieldsToListen = ['area-terreno-imovel', 'area-construcao', 'custo-direto', 'custo-indireto', 'beneficio', 'depreciacao'];
                fieldsToListen.forEach(id => document.getElementById(id).addEventListener('input', calculateAndDisplayAll));

                document.querySelectorAll('#terrain-comparison-table input').forEach(input => input.addEventListener('input', calculateAndDisplayAll));
                document.querySelectorAll('.annual-cost-input').forEach(input => input.addEventListener('input', updateTotalAnnualCosts));

                document.getElementById('cidadeImovel').addEventListener('change', () => {
                    const selectedCity = document.getElementById('cidadeImovel').value;
                    document.getElementById('rent-city').value = selectedCity;
                    updateYieldDisplay();
                    calculateAndDisplayAll();
                });

                document.getElementById('rent-city').addEventListener('change', () => {
                    updateYieldDisplay();
                    calculateAndDisplayAll();
                });

                document.getElementById('add-photo-btn').addEventListener('click', () => {
                    if (photoCounter < MAX_PHOTOS) {
                        photoCounter++;
                        createPhotoInput(photoCounter);
                        if (photoCounter === MAX_PHOTOS) document.getElementById('add-photo-btn').style.display = 'none';
                    }
                });

                document.getElementById('avaliador-urbano-app').addEventListener('submit', generateReport);
            }

            // --- REPORT GENERATION ---
            async function generateReport() {
                const getInputValue = id => document.getElementById(id)?.value || 'N/A';
                const formatCurrency = val => `€ ${val.toLocaleString('pt-PT', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                let totalAnnualCosts = 0;
                document.querySelectorAll('.annual-cost-input').forEach(input => {
                    totalAnnualCosts += parseFloat(input.value) || 0;
                });

                const reportData = {
                    solicitante: getInputValue('nomeSolicitante'), avaliador: getInputValue('nomeAvaliador'), idAvaliador: getInputValue('idAvaliador'), regAvaliador: getInputValue('regAvaliador'), objeto: getInputValue('objetoAvaliacao'), dataVisita: getInputValue('dataVisita'), dataRelatorio: getInputValue('dataRelatorio'), tipoImovel: getInputValue('tipoInmueble'), moradaCompleta: `${getInputValue('moradaImovel')}, ${getInputValue('codigoPostalImovel')} ${getInputValue('cidadeImovel')}`, areaConstrucao: parseFloat(getInputValue('area-construcao')) || 0, areaTerreno: parseFloat(getInputValue('area-terreno-imovel')) || 0,
                    swot: { strengths: getInputValue('swot-strengths').replace(/\n/g, '<br>'), weaknesses: getInputValue('swot-weaknesses').replace(/\n/g, '<br>'), opportunities: getInputValue('swot-opportunities').replace(/\n/g, '<br>'), threats: getInputValue('swot-threats').replace(/\n/g, '<br>') },
                    finalRemarks: getInputValue('final-remarks').replace(/\n/g, '<br>'),
                    valorTotal: parseFloat(document.getElementById('total-property-value').textContent.replace(/[€\s.]/g, '').replace(',', '.')) || 0,
                    valorTerreno: parseFloat(document.getElementById('total-terrain-value').textContent.replace(/[€\s.]/g, '').replace(',', '.')) || 0,
                    custoReposicao: parseFloat(document.getElementById('total-construction-value').textContent.replace(/[€\s.]/g, '').replace(',', '.')) || 0,
                    rentabilidade: { yield: document.getElementById('gross-yield-result').textContent, rendaMensal: document.getElementById('monthly-rent-result').textContent, roi: document.getElementById('roi-result').textContent, payback: document.getElementById('payback-result').textContent },
                    custosAnuais: totalAnnualCosts,
                };
                reportData.rentabilidade.rendaAnualBruta = reportData.valorTotal * (parseFloat(reportData.rentabilidade.yield.replace('%', '')) / 100);

                let photosHTML = '';
                let photoCount = 0;
                for (let i = 1; i <= photoCounter; i++) {
                    const fileInput = document.getElementById(`photo-file-${i}`);
                    if (fileInput && fileInput.files[0]) {
                        photoCount++;
                        const desc = document.getElementById(`photo-desc-${i}`).value;
                        const src = document.querySelector(`#photo-preview-${i} img`)?.src;
                        if (src) {
                            photosHTML += `<div class="photo-block"><img src="${src}" alt="Fotografia ${photoCount} do Imóvel"><p class="mt-2"><strong>Fig. ${photoCount}:</strong> ${desc || 'Sem descrição.'}</p></div>`;
                        }
                    }
                }

                let reportHTML = `
                    <div class="report-page">
                        <h2 class="text-center mb-4" style="color: #005A9C;">Relatório de Avaliação de Imóvel</h2>
                        <div class="report-section"><h4>1. Dados Gerais</h4><p><strong>Solicitante:</strong> ${reportData.solicitante}</p><p><strong>Avaliador:</strong> ${reportData.avaliador} (Cédula: ${reportData.idAvaliador}, Registo: ${reportData.regAvaliador})</p><p><strong>Objeto:</strong> ${reportData.objeto}</p><p><strong>Datas:</strong> Visita a ${reportData.dataVisita}, Relatório a ${reportData.dataRelatorio}</p></div>
                        <div class="report-section"><h4>2. Detalhes do Imóvel</h4><p><strong>Tipo:</strong> ${reportData.tipoImovel}</p><p><strong>Morada:</strong> ${reportData.moradaCompleta}</p><p><strong>Área Bruta Privativa:</strong> ${reportData.areaConstrucao} m²</p><p><strong>Área do Terreno:</strong> ${reportData.areaTerreno} m²</p></div>
                        <div class="report-section"><h4>3. Resumo da Valorização</h4><p><strong>Valor Total Estimado:</strong> ${formatCurrency(reportData.valorTotal)}</p><p><strong>Valor do Terreno:</strong> ${formatCurrency(reportData.valorTerreno)}</p><p><strong>Custo de Reposição da Construção:</strong> ${formatCurrency(reportData.custoReposicao)}</p><div class="chart-container"><canvas id="valueBreakdownChart"></canvas></div></div>
                    </div>
                    <div class="report-page">
                        <div class="report-section"><h4>4. Análise de Rentabilidade</h4>
                            <p><strong>Rentabilidade Bruta (Yield) Anual Estimada:</strong> ${reportData.rentabilidade.yield}</p>
                            <p><strong>Renda Mensal Estimada:</strong> ${reportData.rentabilidade.rendaMensal}</p>
                            <p><strong>Retorno Sobre o Investimento (ROI) Anual Estimado:</strong> ${reportData.rentabilidade.roi}</p>
                            <p><strong>Tempo de Retorno da Inversão (Payback):</strong> ${reportData.rentabilidade.payback}</p>
                            <div class="chart-container"><canvas id="profitabilityChart"></canvas></div>
                        </div>
                        <div class="report-section"><h4>5. Análise SWOT</h4><strong>Pontos Fortes:</strong><div>${reportData.swot.strengths || 'N/A'}</div><br><strong>Pontos Fracos:</strong><div>${reportData.swot.weaknesses || 'N/A'}</div><br><strong>Oportunidades:</strong><div>${reportData.swot.opportunities || 'N/A'}</div><br><strong>Ameaças:</strong><div>${reportData.swot.threats || 'N/A'}</div></div>
                        <div class="report-section"><h4>6. Conclusões Finais</h4><p>${reportData.finalRemarks || 'N/A'}</p></div>
                    </div>
                    ${photosHTML ? `<div class="report-page photo-report-section"><h4 class="mb-4">Anexo Fotográfico</h4>${photosHTML}</div>` : ''}
                    <div class="report-page">
                        <div class="report-section" style="border:none;">
                            <h4>Declaração e Assinatura</h4>
                            <p class="text-muted"><small>O presente relatório foi elaborado de forma imparcial e objetiva, com base nas informações recolhidas e na metodologia descrita.</small></p>
                            <div style="margin-top: 4cm; display: flex; justify-content: space-between; text-align: center;">
                                <div style="width: 45%;"><hr style="border-top: 1px solid #333; margin-bottom: 5px;"><p class="mb-0"><strong>${reportData.avaliador}</strong></p><p class="mb-0"><small>O Avaliador</small></p></div>
                                <div style="width: 45%;"><hr style="border-top: 1px solid #333; margin-bottom: 5px;"><p class="mb-0"><strong>${reportData.solicitante}</strong></p><p class="mb-0"><small>O Solicitante</small></p></div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('reportOutput').innerHTML = reportHTML;

                setTimeout(() => {
                    if (valueBreakdownChart) valueBreakdownChart.destroy();
                    valueBreakdownChart = new Chart(document.getElementById('valueBreakdownChart').getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['Valor do Terreno', 'Valor da Construção'],
                            datasets: [{
                                data: [reportData.valorTerreno, reportData.custoReposicao],
                                backgroundColor: ['#36a2eb', '#ff6384'],
                            }]
                        },
                        options: { responsive: true, plugins: { legend: { position: 'top' }, title: { display: true, text: 'Desglose del Valor del Inmueble' } } }
                    });

                    if (profitabilityChart) profitabilityChart.destroy();
                    profitabilityChart = new Chart(document.getElementById('profitabilityChart').getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['Análise Financeira'],
                            datasets: [
                                { label: 'Ingresos Brutos Anuales', data: [reportData.rentabilidade.rendaAnualBruta], backgroundColor: '#28a745' },
                                { label: 'Costes Anuales', data: [reportData.custosAnuais], backgroundColor: '#dc3545' },
                                { label: 'Beneficio Neto Anual', data: [reportData.rentabilidade.rendaAnualBruta - reportData.custosAnuais], backgroundColor: '#007bff' }
                            ]
                        },
                        options: { responsive: true, plugins: { legend: { position: 'top' }, title: { display: true, text: 'Análisis de Rentabilidad Anual' } }, scales: { y: { beginAtZero: true } } }
                    });
                }, 100);

                $('#reportModal').modal('show');
            }

            // --- APP INITIALIZATION ---
            initializeForm();
            setupCalculators();
            setupEventListeners();
        });

        function printReport() {
            window.print();
        }
    </script>
</body>

</html>